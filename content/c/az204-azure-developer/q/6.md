---
title: "Resolve VM Stuck in Windows Update Process"
type: "question"
layout: "multiple"
answers:
    - id: "answer1"
      title: "Attach the OS disk to a recovery VM and start it"
      correct: true
      explain: "This is the first required step to access the problematic OS disk. By attaching the disk to a recovery VM, you can access the file system and run diagnostic and repair commands without needing the original VM to boot."
    - id: "answer2"
      title: "Open an elevated terminal session"
      correct: true
      explain: "Administrative privileges are required to run DISM commands that modify system packages on the attached disk. An elevated command prompt ensures you have the necessary permissions to execute system-level operations."
    - id: "answer3"
      title: "Run: dism /image:{Attached OS disk}:\\ /get-packages > c:\\temp\\log.txt"
      correct: true
      explain: "This DISM command retrieves the list of all installed packages on the attached OS disk and saves them to a log file. This allows you to identify which update package is in an Install Pending or Uninstall Pending state, causing the VM to hang."
    - id: "answer4"
      title: "Open the C:\\temp\\log.txt file, and locate the update that's in Install Pending or Uninstall Pending state"
      correct: true
      explain: "Reviewing the log file helps identify the specific problematic update package that's preventing the VM from starting. Updates stuck in pending states are typically the cause of boot failures during Windows Update."
    - id: "answer5"
      title: "Run: dism /Image:{Attached OS disk}:\\ /remove-package /PackageName:{package to delete}"
      correct: true
      explain: "This command removes the problematic update package from the attached OS disk. Removing the stuck package resolves the boot issue and allows the VM to start normally. The DISM process typically completes within 16 minutes."
    - id: "answer6"
      title: "Detach the OS disk and reattach it to the VM that won't start"
      correct: true
      explain: "After fixing the package issue, reattaching the repaired OS disk to the original VM allows it to boot successfully. This final step completes the recovery process and restores the VM to working condition."
    - id: "answer7"
      title: "Run: sfc /image:{Attached OS disk}:\\ /unlock-image"
      correct: false
      explain: "The System File Checker (SFC) unlock-image command is not part of the standard Windows Update recovery process. This command doesn't exist in SFC's command set, and unlocking images is not required to resolve pending update issues."
    - id: "answer8"
      title: "Run: dism /Image:{Attached OS disk}:\\ /abort-update"
      correct: false
      explain: "While DISM has various update-related commands, /abort-update is not a valid DISM option. The correct approach is to remove the specific problematic package rather than attempting to abort the entire update process."
    - id: "answer9"
      title: "Run: sfc /Image:{Attached OS disk}:\\ /finalize-update"
      correct: false
      explain: "The System File Checker does not have a /finalize-update command. SFC is used for scanning and repairing system files, not for managing Windows Update operations. This command would not help resolve the stuck update issue."
link: "https://learn.microsoft.com/en-us/troubleshoot/azure/virtual-machines/windows/troubleshoot-stuck-updating-boot-error"
more: "Learn more about Troubleshooting Windows Update Issues"
learn: "Troubleshoot VM Update Issues"
---

You work as a Systems Administrator for MDFT Pro, a well-known training agency that operates virtual training labs for students learning Azure technologies. Claire, the IT Operations Manager, has reported that one of the development VMs provisioned for the instructor training environment has become unresponsive. The VM is stuck in a Windows update process and won't start up anymore, preventing trainers from accessing their development tools and course materials. The VM was being used to demonstrate application deployment scenarios to students when the update began. You need to resolve this issue quickly to restore access to the training environment.

What sequence of steps should you perform to fix the VM and restore it to working condition?
