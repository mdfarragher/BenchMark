---
title: "Fix Incorrect HTTP Status Code in API Management"
type: "question"
layout: "single"
answers:
    - id: "answer1"
      title: "set-context"
      correct: false
      explain: "The set-context policy is not a valid Azure API Management policy element. Context variables are set using set-variable, not set-context. This option doesn't exist in the API Management policy framework."
    - id: "answer2"
      title: "set-error"
      correct: false
      explain: "There is no set-error policy in Azure API Management. Error information is accessed through context.LastError, but there's no policy to directly modify error details. The correct approach is to modify the response status code itself."
    - id: "answer3"
      title: "set-status"
      correct: true
      explain: "The set-status policy explicitly sets the HTTP response status code and reason phrase. It's designed for use in on-error sections to transform incorrect status codes (like 500) into the correct ones (like 409 for conflicts). The syntax is: <set-status code='409' reason='conflict' />."
    - id: "answer4"
      title: "override-context"
      correct: false
      explain: "There is no override-context policy in Azure API Management. While you can access context information through the context object, there's no policy specifically named override-context for modifying context data."
    - id: "answer5"
      title: "override-error"
      correct: false
      explain: "The override-error policy doesn't exist in Azure API Management. While you can handle errors in the on-error section, there's no specific override-error policy element. Error handling uses existing policies like set-status and return-response."
    - id: "answer6"
      title: "override-status"
      correct: false
      explain: "While this name sounds plausible, the actual policy name in Azure API Management is simply set-status, not override-status. The set-status policy is the standard way to modify HTTP status codes in responses."
link: "https://learn.microsoft.com/en-us/azure/api-management/set-status-policy"
more: "Learn more about Set-Status Policy"
learn: "API Management Set-Status"
---

You work as an API Developer for MDFT Pro, a well-known training agency that delivers certification courses to students worldwide. Mark, the Integration Services Manager, has deployed a REST web service that manages course enrollments and student registrations. The service is accessed through an Azure API Management instance that provides rate limiting, authentication, and policy enforcement. During testing, you discovered that when two trainers attempt to enroll the same student in a course simultaneously, the backend service doesn't properly handle the conflict scenario. Instead of returning the correct HTTP 409 (Conflict) status code, the service returns a generic HTTP 500 (Internal Server Error) with only the word "conflict" in the response body. Students and trainers see confusing error messages, and monitoring systems can't properly track conflict errors versus actual server failures. You need to configure an API Management policy in the on-error section that detects this specific error condition and transforms it into the correct HTTP response.

How should you complete the policy to ensure conflicts produce the correct HTTP 409 status code?

```xml
<on-error>
	<base />
	<choose>
		<when condition="@(context.Response.StatusCode == 500 && context.LastError.Message.Contains("conflict"))">
			<return-response>
				<__________ code="409" reason="conflict" />
			</return-response>
		</when>
		<otherwise />
	</choose>
</on-error>
```
