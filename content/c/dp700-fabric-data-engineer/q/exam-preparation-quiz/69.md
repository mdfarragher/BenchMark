---
title: "Complete SQL Query For Hierarchical Summaries"
type: "question"
layout: "single"
answers:
    - id: "answer1"
      title: "CUBE (YEAR (so.ModifiedDate), p.Name)"
      correct: true
      explain: "CUBE generates all possible combinations of groupings, including grand totals for years, products, year-product combinations, and an overall grand total. This satisfies the requirement to include a summary of order quantities at the year level for all products."
    - id: "answer2"
      title: "GROUPING SETS ((YEAR (so.ModifiedDate), p.Name), (YEAR (so.ModifiedDate)))"
      correct: false
      explain: "While GROUPING SETS would provide year-product combinations and year-level summaries, it requires explicit specification of each grouping level and is more verbose than CUBE. It also doesn't automatically include all combinations that CUBE provides."
    - id: "answer3"
      title: "ROLLUP (YEAR (so.ModifiedDate), p.Name)"
      correct: false
      explain: "ROLLUP creates a hierarchy from left to right, providing year-product combinations, year totals, and grand totals. However, it doesn't provide product-level summaries across all years, which CUBE does."
    - id: "answer4"
      title: "YEAR (so.ModifiedDate), p.Name"
      correct: false
      explain: "A standard GROUP BY without aggregation modifiers only provides detailed results grouped by year and product name, without any summary rows at the year level or grand totals as required."
link: "https://learn.microsoft.com/en-us/sql/t-sql/queries/select-group-by-transact-sql"
more: "Learn more about SQL GROUP BY CUBE and ROLLUP"
learn: "SQL GROUP BY Operations"
---
You work as a Business Intelligence Developer for Mark at MDFT Pro, a well-known training agency. MDFT Pro operates a Fabric workspace that contains a warehouse named DW1, which stores sales data for training courses and educational materials. The warehouse contains a SalesOrderDetail table tracking order quantities with product IDs and modification dates, and a Product table with product names. Mark has asked you to create a report that presents summarized values of all order quantities by year and product. The business requirement specifies that the results must include not only the detailed year-product combinations but also a summary of the order quantities at the year level for all products combined, allowing stakeholders to see both granular and aggregated sales patterns.

The warehouse contains the following structure:

| Table Name       | Column Name  | Description                    |
| ---------------- | ------------ | ------------------------------ |
| SalesOrderDetail | ProductID    | The ID of the ordered product  |
| SalesOrderDetail | ModifiedDate | The date of the order          |
| SalesOrderDetail | OrderQty     | The number of products ordered |
| Product          | ProductID    | The unique ID of a product     |
| Product          | Name         | The name of a product          |

How should you complete the code?

```sql
SELECT
    YEAR(ModifiedDate) AS OrderDate,
    p.Name AS ProductName,
    SUM(so.OrderQty) AS OrderQty
FROM
    dbo.SalesOrderDetail so
    INNER JOIN dbo.Product p ON p.ProductID = so.ProductID
GROUP BY
    ____________________
```
